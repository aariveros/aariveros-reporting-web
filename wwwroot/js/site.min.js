var reporting={views:{},models:{},loadTemplates:function(e,t){var i=[];$.each(e,function(e,t){reporting[t]?i.push($.get("tpl/"+t+".html",function(e){reporting[t].prototype.template=_.template(e)},"html")):alert(t+" not found")}),$.when.apply(null,i).done(t)}};reporting.Router=Backbone.Router.extend({routes:{"":"home",contact:"contact","employees/:id":"employeeDetails"},initialize:function(){reporting.shellView=new reporting.ShellView,$("body").html(reporting.shellView.render().el),$("body").click(function(){$(".dropdown").removeClass("open")}),this.$content=$("#content")},home:function(){reporting.homelView?(console.log("reusing home view"),reporting.homelView.delegateEvents()):(reporting.homelView=new reporting.HomeView,reporting.homelView.render()),this.$content.html(reporting.homelView.el),reporting.shellView.selectMenuItem("home-menu")},contact:function(){reporting.contactView||(reporting.contactView=new reporting.ContactView,reporting.contactView.render()),this.$content.html(reporting.contactView.el),reporting.shellView.selectMenuItem("contact-menu")},employeeDetails:function(e){var t=new reporting.Employee({id:e}),i=this;t.fetch({success:function(e){console.log(e),i.$content.html(new reporting.EmployeeView({model:e}).render().el)}}),reporting.shellView.selectMenuItem()}}),$(document).on("ready",function(){reporting.loadTemplates(["HomeView","ContactView","ShellView","EmployeeView","EmployeeSummaryView","EmployeeListItemView"],function(){reporting.router=new reporting.Router,Backbone.history.start()})}),reporting.Employee=Backbone.Model.extend({urlRoot:"/reporting-rest-php/employees",initialize:function(){this.reports=new reporting.EmployeeCollection,this.reports.url=this.urlRoot+"/"+this.id+"/reports"}}),reporting.EmployeeCollection=Backbone.Collection.extend({model:reporting.Employee,url:"/reporting-rest-php/employees"}),reporting.ContactView=Backbone.View.extend({render:function(){return this.$el.html(this.template()),this}}),reporting.EmployeeView=Backbone.View.extend({render:function(){return this.$el.html(this.template(this.model.attributes)),$("#details",this.el).html(new reporting.EmployeeSummaryView({model:this.model}).render().el),this.model.reports.fetch({success:function(e){0==e.length&&$(".no-reports").show()}}),$("#reports",this.el).append(new reporting.EmployeeListView({model:this.model.reports}).render().el),this}}),reporting.EmployeeSummaryView=Backbone.View.extend({initialize:function(){this.model.on("change",this.render,this)},render:function(){return this.$el.html(this.template(this.model.attributes)),this}}),reporting.EmployeeListView=Backbone.View.extend({tagName:"ul",className:"nav nav-list",initialize:function(){var e=this;this.model.on("reset",this.render,this),this.model.on("add",function(t){e.$el.append(new reporting.EmployeeListItemView({model:t}).render().el)})},render:function(){return this.$el.empty(),_.each(this.model.models,function(e){this.$el.append(new reporting.EmployeeListItemView({model:e}).render().el)},this),this}}),reporting.EmployeeListItemView=Backbone.View.extend({tagName:"li",initialize:function(){this.model.on("change",this.render,this),this.model.on("destroy",this.close,this)},render:function(){var e=_.clone(this.model.attributes);return e.id=this.model.id,this.$el.html(this.template(e)),this}}),reporting.HomeView=Backbone.View.extend({events:{"click #showMeBtn":"showMeBtnClick"},render:function(){return this.$el.html(this.template()),this},showMeBtnClick:function(){console.log("showme"),reporting.shellView.search()}}),reporting.ShellView=Backbone.View.extend({initialize:function(){this.searchResults=new reporting.EmployeeCollection,this.searchresultsView=new reporting.EmployeeListView({model:this.searchResults,className:"dropdown-menu"})},render:function(){return this.$el.html(this.template()),$(".navbar-search",this.el).append(this.searchresultsView.render().el),this},events:{"keyup .search-query":"search","keypress .search-query":"onkeypress"},search:function(e){var t=$("#searchText").val();this.searchResults.fetch({reset:!0,data:{name:t}});setTimeout(function(){$(".dropdown").addClass("open")})},onkeypress:function(e){13===e.keyCode&&e.preventDefault()},selectMenuItem:function(e){$(".navbar .nav li").removeClass("active"),e&&$("."+e).addClass("active")}});